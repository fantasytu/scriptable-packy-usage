# Packy 使用情况小部件

[English](./README.md) | [中文](./README.zh-CN.md)

一个强大的 iOS Scriptable 小部件，实时展示你的 API 使用统计信息。直接从主屏幕监控你的余额、支出和模型使用情况。

**作者：** Fantasy
**日期：** 2025-11-19

---

## 功能特性

### 📊 实时使用情况追踪
- 显示当前账户余额和剩余配额
- 追踪每日、每周、每月的 API 使用情况
- 监控请求数和 Token 消耗量
- 查看每个时期的支出统计

### 🎨 三种小部件尺寸
小部件支持多种尺寸以适应你的主屏幕布局：

#### 小型小部件
![小型小部件](./small.PNG)
*紧凑视图，显示余额、使用进度和关键指标*

#### 中型小部件
![中型小部件](./medium.PNG)
*平衡布局，包含使用条形图和模型分布图*

#### 大型小部件
![大型小部件](./big.PNG)
*全功能视图，包含详细统计和 30 天图表*

### 🌗 深色和浅色模式支持
![深色和浅色模式](./dark%20and%20light%20mode.jpg)
*自动适应你的系统外观设置*

### 📈 高级可视化
- **进度条**：剩余余额和每日使用的可视化表示
- **使用指示器**：显示平均值 (AVG) 和最大值 (MAX) 标签
- **模型分布**：条形图显示最常使用的 AI 模型
- **范围指示器**：模型使用情况的可视范围显示

### 🤖 多模型支持
追踪跨多个 AI 模型的使用情况，包括：
- OpenAI (GPT-5, GPT-5.1)
- Anthropic (Claude Haiku, Sonnet, Opus)
- Google (Gemini Flash, Pro)
- 以及更多...

---

## 安装说明

1. **打开 Scriptable 应用** - 在你的 iOS 设备上打开 Scriptable 应用
2. **创建新脚本** - 复制 `Packy Usage.js` 的全部内容到新脚本
3. **配置你的凭证**：
   - 从 Packy API 获取你的 `USER_ID` 和 `SESSION`
   - 更新 `CONFIG` 对象：
     ```javascript
     const CONFIG = {
       API_BASE_URL: "https://www.packyapi.com",
       USER_ID: "your_user_id",
       SESSION: "your_session_token",
       UNIT: 500000,
       DAYS_TO_FETCH: 30,
     };
     ```
4. **添加到主屏幕**：
   - 长按主屏幕
   - 点击"+"添加小部件
   - 搜索"Scriptable"
   - 选择你需要的尺寸（小、中或大）
   - 选择你创建的脚本
   - 点击"添加小部件"

---

## 小部件尺寸说明

### 小型小部件
**最适合：** 快速查看你的余额
**显示内容：**
- 当前余额
- 剩余配额 vs 已用配额
- 今日支出
- 本周使用的 Token
- 当前请求数

### 中型小部件
**最适合：** 平衡的信息显示
**显示内容：**
- 左侧：余额、使用指标和信息
- 右侧：用户名、模型图例、周表
- 紧凑但全面的视图

### 大型小部件
**最适合：** 深入的分析
**显示内容：**
- 顶部：余额和用户信息
- 中部：总支出、Token 和请求
- 最常使用的模型及范围指示器
- 底部：模型详细分解和 30 天图表

---

## 使用指示器说明

### 进度条
小部件显示两个进度条：

1. **剩余条**（顶部）
   - 显示你的可用余额 vs 已使用金额
   - 颜色表示健康状态：
     - 🟢 绿色：健康状态（剩余 > 20%）
     - 🟡 黄色：警告状态（剩余 10-20%）
     - 🔴 红色：关键状态（剩余 < 10%）

2. **使用条**（底部）
   - 显示今日使用量与最大值的对比
   - **• AVG**：平均每日使用量标记
   - **MAX •**：达到最大使用量的标记
   - 当空间不足时标签会隐藏

---

## 数据刷新

小部件在每次交互时获取新数据。数据包括：
- 过去 30 天的 API 使用情况
- 按模型划分的每日使用量
- 总使用统计
- 当前余额信息

---

## 技术细节

### 架构
- **ColorManager**：处理所有颜色主题和特定模型的颜色
- **DataFetcher**：从 Packy 服务器检索 API 数据
- **DataProcessor**：将原始数据处理为可用的统计数据
- **ChartRenderer**：创建图表和可视化
- **UIComponents**：构建小部件 UI 元素
- **BaseWidget**：所有小部件尺寸的基础
- **WidgetFactory**：根据尺寸创建相应小部件

### 关键技术
- **DrawContext**：用于精确的像素级图形渲染
- **ListWidget**：Scriptable 的布局系统
- **Dynamic Colors**：自动深色/浅色模式支持

---

## 自定义

你可以自定义小部件的多个方面：

```javascript
const UI_CONSTANTS = {
  WIDGET_CORNER_RADIUS: 12,      // 边框半径
  GAUGE_SPACING: 12,              // 元素之间的间距
  THRESHOLDS: { GOOD: 20, WARNING: 10 },  // 警告阈值
};
```

---

## 故障排除

### 小部件显示错误
- 验证你的 `USER_ID` 和 `SESSION` 是否正确
- 检查你的网络连接
- 确保你使用的是最新版本的 Scriptable

### 数据未更新
- 点击小部件进行刷新
- 检查 API 是否正在响应
- 审查 CONFIG 中的凭证

### 标签重叠或消失
- 这是有意设计 - 当空间不足时标签会隐藏
- 确保你的小部件尺寸适合你的屏幕

---

## 配色方案

| 元素 | 浅色模式 | 深色模式 |
|------|---------|---------|
| 文本 | #000000 | #FFFFFF |
| 次要文本 | #8E8E93 | #636366 |
| 背景 | #F2F2F7 | #1C1C1E |
| 进度条 | #5E5CE6 | #5E5CE6 |

### AI 模型颜色

| 模型系列 | 浅色 | 深色 |
|---------|------|------|
| GPT-5 | #007AFF | #0A84FF |
| GPT-5.1 | #0052CC | #0066FF |
| Claude Haiku | #FFB800 | #FFD60A |
| Claude Sonnet | #FF8C00 | #FFAB00 |
| Claude Opus | #FF3B00 | #FF5733 |
| Gemini 2.5 Flash | #C77DFF | #D896FF |
| Gemini 2.5 Pro | #9D4EDD | #B565F2 |
| Gemini 3 Pro | #7C3AED | #A78BFA |
| Sora | #34C759 | #30D158 |
| VeO | #28A745 | #32CD32 |

---

## 许可证

这个小部件是为个人使用而创建的。欢迎根据你的需要修改和调整它。

---

## 支持

如有问题或疑问：
1. 查看 Packy API 文档
2. 验证你的凭证是否正确
3. 确保 Scriptable 具有必要的权限
4. 查看 Scriptable 中的控制台日志以获取错误信息

---

**祝你使用愉快！📊**
